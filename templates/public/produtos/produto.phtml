<?php

use Ajrc\Helper\Sessions;
use Ajrc\Helper\AlertBootstrap4 as Alert;
use Ajrc\Model\Destaque;
use Ajrc\Model\Produto;

if(!array_key_exists("id",$data)) { 
  header("location: ./notfound");
  exit();
}


$P = Produto::List($data["id"]);

if($P==null) { 
  header("location: ./notfound?msg=deste Produto");
  exit(); 
}

$estoque = $P->qtde_atual;
$htmlEstoque = '<div><i data-feather="check-circle" class="text-danger"></i><small class="ml-2">Sem produto em estoque no momento!</small></div>';
if($estoque>0)
{
  $htmlEstoque = '<div><i data-feather="check-circle" class="text-success"></i><small class="ml-2">Produto em estoque!</small></div>';
}

// SEO : SEARCH ENGINE OPTIMIZATE ----
$title = $P->titulo ." -  Por apenas R\$".number_format($P->preco_venda,2,',','.') . " - Chokoart! ";
$description = $title . $P->descritivo;
$url_redirect = (isset($_SERVER['HTTPS']) && $_SERVER['HTTPS'] === 'on' ? "https" : "http") . "://$_SERVER[HTTP_HOST]$_SERVER[REQUEST_URI]";
//----

$mais_imagens = null;
$pasta_imagens = "img/produtos/";
$contador = 0;
$url_img_1 = null;
$checked = null;
foreach (glob($pasta_imagens . $P->id."_*") as $fotos) 
{
    if($contador==0){ $url_img_1 = $fotos; $checked = " checked"; }
    $mais_imagens.=  '<img src="'.$fotos.'" data-large=".'.$fotos.'" alt="'.$title.'" class="swiper-slide swiper-slide-active" data-swiper-slide-index="0" style="width: 442px;">';
    $contador++;
}

require_once("../templates/public/header.php");
require_once("../templates/public/topo.php");

?>

<!-- Main Content -->


<div class="container mt-3">

      <!-- Shop Toolbar -->
      <div class="card mb-3">
        <div class="card-body d-flex justify-content-end align-items-center py-2">
          <ol class="breadcrumb d-none d-md-flex p-0 mb-0 mr-auto">
            <li class="breadcrumb-item"><a href="./">Página Principal</a></li>
            <li class="breadcrumb-item"><a href="./categoria-<?php echo $P->categoria_id; ?>--<?php echo str_replace(" ","-",$P->categoria); ?>"><?php echo $P->categoria; ?></a></li>
            <li class="breadcrumb-item active" aria-current="page"><?php echo $P->titulo; ?></li>
          </ol>
          <span class="text-muted mr-1">Compartilhe:</span>
          <a href="https://www.facebook.com/sharer.php?u=<?php echo $url_redirect; ?>" class="btn btn-icon rounded-pill btn-sm btn-outline-primary ml-1" data-toggle="tooltip" target="_blank" title="no Facebook"><i data-feather="facebook"></i></a>
          <a href="http://twitter.com/intent/tweet?text=<?php echo $title;?>&url=<?php echo $url_redirect; ?>&via=@chokoart.com" class="btn btn-icon rounded-pill btn-sm btn-outline-primary ml-1" data-toggle="tooltip" target="_blank" title="no Twitter"><i data-feather="twitter"></i></i></a>
        </div>
      </div>
      <!-- /Shop Toolbar -->

      <div class="card">
        <div class="card-body">
          <div class="row">
            <div class="col-md-6">

                <div class="swiper-container swiper-container-initialized swiper-container-horizontal" id="product-slider">
                    <div class="swiper-wrapper" style="transition-duration: 0ms; transform: translate3d(-442px, 0px, 0px);">
                        <?php echo $mais_imagens; ?>
                    </div>
                    <div class="swiper-pagination swiper-pagination-clickable swiper-pagination-bullets"><span class="swiper-pagination-bullet swiper-pagination-bullet-active" tabindex="0" role="button" aria-label="Go to slide 1"></span><span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 2"></span><span class="swiper-pagination-bullet" tabindex="0" role="button" aria-label="Go to slide 3"></span></div>
                    <div class="swiper-button-prev autohide" tabindex="0" role="button" aria-label="Previous slide"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-left"><polyline points="15 18 9 12 15 6"></polyline></svg></div>
                    <div class="swiper-button-next autohide" tabindex="0" role="button" aria-label="Next slide"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"><polyline points="9 18 15 12 9 6"></polyline></svg></div>
                    <button class="wishlist atw-demo" style="width:58px;height:58px;" id="<?php echo $P->id; ?>" data-value="<?php echo $P->preco_venda; ?>" title="Adicionar a sua Lista de Desejos!"><svg xmlns="http://www.w3.org/2000/svg" width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round" class="feather feather-heart"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"></path></svg></button>
                </div>
              <hr>
              <form method="POST" action="./cart">
              <input type="hidden" name="passo" value="0">
              <input type="hidden" name="produto_id"  value="<?php echo $P->id; ?>">
              <input type="hidden" name="titulo" value="<?php echo $P->titulo; ?>">
              <input type="hidden" name="qtde_estoque" id="qtde_estoque-<?php echo $P->id; ?>" value="<?php echo $P->qtde_atual; ?>">
              <input type="hidden" name="preco_unit_item" id="preco_unit_item-<?php echo $P->id; ?>" value="<?php echo $P->preco_venda; ?>">
              <input type="hidden" name="preco_total_item" id="preco_total_item-<?php echo $P->id; ?>" value="<?php echo $P->preco_venda; ?>">
              <input type="hidden" name="valor_total_pedido" id="valor_total_pedido" value="<?php echo $P->preco_venda; ?>">
                <div class="form-row">
                  <div class="form-group col-6">
                    <label class="bold">Quantidade</label>
                    <div class="w-100 spinner">
                      <button id="btnMenos-<?php echo $P->id; ?>" type="button" class="btn btn-icon rounded-circle menos"><i data-feather="minus"></i></button>
                      <input id="qtde-<?php echo $P->id; ?>" name="qtde" type="number" class="form-control" value="1" min="0" max="999">
                      <button id="btnMais-<?php echo $P->id; ?>" type="button" class="btn btn-icon rounded-circle mais"><i data-feather="plus"></i></button>
                    </div>

                  </div>
                  <div class="form-group col-6 d-flex align-items-end">
                    <button type="submit" class="btn btn-primary btn-block rounded-pill">Adicionar ao  <i data-feather="shopping-cart"></i></button>
                  </div>
                </div>
              </form>
              <hr>
            </div>
            <div class="col-md-6 mt-3 mt-md-0">
                <h3 class="card-title"><?php echo $P->titulo; ?></h3>
                <?php echo $htmlEstoque; ?>
                <hr style="border-top: dotted 1px">
                <div class="d-flex justify-content-start">Avaliação de nosso clientes: <strong class="ml-1">4.5</strong> <span class="rating ml-2" data-value="4.5"></span> </div>
                <hr>
                <h2 class="price text-left"><span>R$ <?php echo number_format($P->preco_venda,2,',','.'); ?></span></h2>
                <hr style="border-top: dotted 1px">
                <p class=""><?php echo nl2br($P->descritivo); ?></p>
                
              <div class="d-flex align-items-center">
                <span class="text-muted">Compartilhe </span>
                <a  href="https://www.facebook.com/sharer.php?u=<?php echo $url_redirect; ?>" target="_blank" title="Compartilhar no Facebook" class="btn btn-light btn-icon rounded-circle border ml-2" data-toggle="tooltip" data-original-title="Facebook"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-facebook"><path d="M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z"></path></svg></a>
                <a href="http://twitter.com/intent/tweet?text=<?php echo $title;?>&url=<?php echo $url_redirect; ?>&via=@chokoart.com" class="btn btn-light btn-icon rounded-circle border ml-2" data-toggle="tooltip" title="" data-original-title="Twitter"><svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-twitter"><path d="M23 3a10.9 10.9 0 0 1-3.14 1.53 4.48 4.48 0 0 0-7.86 3v1A10.66 10.66 0 0 1 3 4s-4 9 5 13a11.64 11.64 0 0 1-7 2c9 5 20 0 20-11.5a4.5 4.5 0 0 0-.08-.83A7.72 7.72 0 0 0 23 3z"></path></svg></a>
              </div>
            </div>
          </div>
        </div>
        
      </div>

      <!-- Related Products -->
      <h4 class="bold text-center mt-gutter">Produtos Relacionados</h4>
      <div class="grid grid-gap-3 grid-col-2 grid-col-md-4 my-3">
            <?php Produto::GetPublicRelationed($P->id, $P->categoria_id); ?>
      </div>
      <!-- /Related Products -->

    </div>
<!-- /Main Content -->

<!-- Add review modal -->
<div class="modal fade" tabindex="-1" role="dialog" id="reviewModal">
      <div class="modal-dialog" role="document">
        <div class="modal-content bg-light">
          <div class="modal-header">
            <h5 class="modal-title">Deixe uma avaliação</h5>
            <button type="button" class="close" data-dismiss="modal" aria-label="Close">
              <span aria-hidden="true">&times;</span>
            </button>
          </div>
          <div class="modal-body">
            <form class="form-style-1">
              
              <div class="form-group">
                <label for="reviewRating">Na sua opinião, merece quantas estrelas?</label>
                <select class="form-control bg-white custom-select" id="reviewRating">
                  <option value="5.0">5 Estrelas</option>
                  <option value="4.0">4 Estrelas</option>
                  <option value="3.0">3 Estrelas</option>
                  <option value="2.0">2 Estrelas</option>
                  <option value="1.0">1 Estrela</option>
                </select>
              </div>
              <div class="form-group">
                <label for="reviewText">Escreva sua opinião</label>
                <textarea class="form-control bg-white" id="reviewText" rows="5"></textarea>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn rounded-pill btn-secondary" data-dismiss="modal">Cancelar</button>
            <button type="submit" class="btn rounded-pill btn-primary">Enviar</button>
          </div>
        </div>
      </div>
    </div>
    <!-- /Add review modal -->

    


<!-- Footer -->
<?php 
require_once("../templates/public/footer.php"); 
?>
<!-- /Footer -->


    <script src="plugins/jquery/jquery.min.js"></script>
    <script src="plugins/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="plugins/feather-icons/feather.min.js"></script>
    <script src="plugins/metismenu/metisMenu.min.js"></script>
    <script src="plugins/perfect-scrollbar/perfect-scrollbar.min.js"></script>
    <script src="plugins/swiper/swiper.min.js"></script>
    <script src="plugins/photoswipe/photoswipe.min.js"></script>
    <script src="plugins/photoswipe/photoswipe-ui-default.min.js"></script>
    <script src="plugins/noty/noty.min.js"></script>
    <script src="dist/js/script.min.js"></script>
    <script src="js/produto.js"></script>
    <script>
    $(function () {

      App.rating()
      App.atwDemo()
      App.colorOption()

      setTimeout(function (argument) {
        var productSlider = new Swiper('#product-slider', {
          loop: true,
          pagination: {
            el: '.swiper-pagination',
            clickable: true
          },
          navigation: {
            nextEl: '.swiper-button-next',
            prevEl: '.swiper-button-prev',
          }
        })
      }, 100)

      // Collect items for photoswipe
      var items = []
      $('.swiper-wrapper img').each(function () {
        items.push({
          src: $(this).data('large'),
          w: 1395,
          h: 1500
        })
      })

      var openPhotoSwipe = function (items, activeIndex) {
        activeIndex = typeof activeIndex !== 'undefined' ? activeIndex : 0
        var pswpElement = document.querySelectorAll('.pswp')[0]
        var options = {
          index: activeIndex
        }
        var gallery = new PhotoSwipe(pswpElement, PhotoSwipeUI_Default, items, options)
        gallery.init()
      }

      $('.zoom').click(function () {
        openPhotoSwipe(items, $('.swiper-wrapper').find('.swiper-slide-active').data('swiper-slide-index'))
      })

      <?php
        if(Sessions::UserID()!="") { 
            echo "WishList.Persistence('../add-whislist');"; 
        }
        ?>

    })
    </script>




</body>
</html>
